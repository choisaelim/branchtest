import re

field_value = {}    # field_value 딕셔너리 선언
   
field_value['06_DESCRIPTION'] = '' 
field_value['06_UNIT'] = ''  
field_value['06_RATE'] = ''  
field_value['06_QTY'] = '' 
field_value['06_DEBIT'] = '' 
field_value['06_CREDIT'] = ''  

#field_value = inputOcr_list
inputOcr_list = ''
#처리로그 기준 데이터
inputOcr_list = [
(24, 63, 97.28375673294067, 'ISF FILING FEE', 'eng', 86, 1525, 356, 1552, 0),
(24, 64, 99.9998927116394, '25.00', 'eng', 1392, 1521, 1490, 1556, 0),
(24, 65, 99.99871253967285, '1.00', 'eng', 1596, 1519, 1677, 1558, 0),
(24, 66, 61.29290461540222, 'c', 'eng', 1753, 1521, 1787, 1559, 0),
(24, 67, 99.99988675117493, '25.00', 'eng', 1969, 1521, 2067, 1558, 0),
(25, 68, 98.38528633117676, 'HANDLING CHARGE TO AGENT', 'eng', 87, 1578, 652, 1608, 0),
(25, 69, 99.99980926513672, '50.00', 'eng', 1393, 1575, 1491, 1612, 0),
(25, 70, 99.99903440475464, '1.00', 'eng', 1596, 1574, 1677, 1614, 0),
(25, 71, 62.32519745826721, 'c', 'eng', 1753, 1573, 1788, 1615, 0),
(25, 72, 96.9930350780487, '50.00', 'eng', 1970, 1575, 2066, 1611, 0),
(26, 73, 98.54395985603333, 'CONTAINER DRAYAGE FEE', 'eng', 87, 1632, 581, 1662, 0),
(26, 74, 99.99988675117493, '540.00', 'eng', 1372, 1630, 1489, 1665, 0),
(26, 75, 99.99964833259583, '10.00', 'eng', 1577, 1629, 1676, 1665, 0),
(26, 76, 62.34261989593506, 'c', 'eng', 1753, 1626, 1787, 1668, 0),
(26, 77, 99.96921420097351, '5,400.00', 'eng', 1918, 1630, 2066, 1667, 0),
(27, 78, 99.57087635993958, 'CHASSIS RENTAL FEE', 'eng', 87, 1687, 492, 1717, 0),
(27, 79, 99.99992251396179, '80.00', 'eng', 1392, 1685, 1490, 1720, 0),
(27, 80, 99.99920129776001, '10.00', 'eng', 1579, 1684, 1677, 1721, 0),
(27, 81, 60.06753444671631, 'c', 'eng', 1753, 1682, 1788, 1723, 0),
(27, 82, 99.99988675117493, '800.00', 'eng', 1949, 1685, 2066, 1720, 0),
(28, 83, 62.0053231716156, 'c', 'eng', 1753, 1736, 1787, 1778, 0),
(29, 84, 97.39663600921631, 'TOLL FEE', 'eng', 85, 1741, 266, 1771, 0),
(29, 85, 99.99991655349731, '40.00', 'eng', 1392, 1738, 1490, 1776, 0),
(29, 86, 99.99906420707703, '10.00', 'eng', 1579, 1738, 1677, 1776, 0),
(29, 87, 99.99993443489075, '400.00', 'eng', 1948, 1737, 2067, 1776, 0),
(30, 88, 99.83962774276733, 'PORT CONGESTION CHARGE', 'eng', 87, 1796, 618, 1826, 0),
(30, 89, 99.99980926513672, '50.00', 'eng', 1393, 1793, 1491, 1830, 0),
(30, 90, 99.99960064888, '10.00', 'eng', 1575, 1792, 1676, 1829, 0),
(30, 91, 60.986876487731934, 'c', 'eng', 1753, 1791, 1787, 1830, 0),
(30, 92, 99.99990463256836, '500.00', 'eng', 1949, 1794, 2067, 1829, 0),
(31, 93, 90.27036428451538, 'TOTAL', 'eng', 1804, 2339, 1932, 2373, 0),
(31, 94, 99.9933123588562, '7175.00', 'eng', 2026, 2339, 2162, 2373, 0),
(31, 95, 99.97852444648743, '0', 'eng', 2368, 2338, 2397, 2374, 0),
(32, 96, 99.7668981552124, 'PAID AMOUNT', 'eng', 1671, 2398, 1929, 2428, 0),
(32, 97, 99.99996423721313, '0.00', 'eng', 2316, 2395, 2395, 2431, 0),
(33, 98, 96.73216342926025, 'GRAND TOTAL BALANCE DUE TO OTA AMERICA, INC. - ATLANTA', 'eng', 93, 2456, 1281, 2490, 0),
(33, 99, 99.91431832313538, 'USD', 'eng', 2080, 2453, 2167, 2493, 0),
(33, 100, 99.95108842849731, '7,175.00', 'eng', 2245, 2456, 2395, 2490, 0),
(34, 101, 99.87988471984863, 'REMARK', 'eng', 593, 2584, 729, 2611, 0)]

#field_value에 inputOcrList 내 line, no, text, x1등 값 확인하여 가공한 데이터
inputOcr_list = [
(0, 0, 97.28375673294067, 'ISF FILING FEE', 'eng', 86, 1525, 356, 1552, 0),
(0, 1, 99.9998927116394, '25.00', 'eng', 1392, 1521, 1490, 1556, 0),
(0, 2, 99.99871253967285, '1.00', 'eng', 1596, 1519, 1677, 1558, 0),
(0, 3, 61.29290461540222, 'c', 'eng', 1753, 1521, 1787, 1559, 0),
(0, 4, 99.99988675117493, '25.00', 'eng', 1969, 1521, 2067, 1558, 0),
(1, 0, 98.38528633117676, 'HANDLING CHARGE TO AGENT', 'eng', 87, 1578, 652, 1608, 0),
(1, 1, 99.99980926513672, '50.00', 'eng', 1393, 1575, 1491, 1612, 0),
(1, 2, 99.99903440475464, '1.00', 'eng', 1596, 1574, 1677, 1614, 0),
(1, 3, 62.32519745826721, 'c', 'eng', 1753, 1573, 1788, 1615, 0),
(1, 4, 96.9930350780487, '50.00', 'eng', 1970, 1575, 2066, 1611, 0),
(2, 0, 98.54395985603333, 'CONTAINER DRAYAGE FEE', 'eng', 87, 1632, 581, 1662, 0),
(2, 1, 99.99988675117493, '540.00', 'eng', 1372, 1630, 1489, 1665, 0),
(2, 2, 99.99964833259583, '10.00', 'eng', 1577, 1629, 1676, 1665, 0),
(2, 3, 62.34261989593506, 'c', 'eng', 1753, 1626, 1787, 1668, 0),
(2, 4, 99.96921420097351, '5,400.00', 'eng', 1918, 1630, 2066, 1667, 0),
(3, 0, 99.57087635993958, 'CHASSIS RENTAL FEE', 'eng', 87, 1687, 492, 1717, 0),
(3, 1, 99.99992251396179, '80.00', 'eng', 1392, 1685, 1490, 1720, 0),
(3, 2, 99.99920129776001, '10.00', 'eng', 1579, 1684, 1677, 1721, 0),
(3, 3, 60.06753444671631, 'c', 'eng', 1753, 1682, 1788, 1723, 0),
(3, 4, 99.99988675117493, '800.00', 'eng', 1949, 1685, 2066, 1720, 0),
(4, 1, 62.0053231716156, 'c', 'eng', 1753, 1736, 1787, 1778, 0),
(4, 0, 97.39663600921631, 'TOLL FEE', 'eng', 85, 1741, 266, 1771, 0),
(4, 2, 99.99991655349731, '40.00', 'eng', 1392, 1738, 1490, 1776, 0),
(4, 3, 99.99906420707703, '10.00', 'eng', 1579, 1738, 1677, 1776, 0),
(4, 4, 99.99993443489075, '400.00', 'eng', 1948, 1737, 2067, 1776, 0),
(5, 0, 99.83962774276733, 'PORT CONGESTION CHARGE', 'eng', 87, 1796, 618, 1826, 0),
(5, 1, 99.99980926513672, '50.00', 'eng', 1393, 1793, 1491, 1830, 0),
(5, 2, 99.99960064888, '10.00', 'eng', 1575, 1792, 1676, 1829, 0),
(5, 3, 60.986876487731934, 'c', 'eng', 1753, 1791, 1787, 1830, 0),
(5, 4, 99.99990463256836, '500.00', 'eng', 1949, 1794, 2067, 1829, 0),
(6, 0, 90.27036428451538, 'TOTAL', 'eng', 1804, 2339, 1932, 2373, 0)]

#5개씩 뽀개기
#x로 정렬
list_size = len(inputOcr_list)  # inputOcr_list의 길이를 list_size에 저장
container_pattern = r"\-\w{3}U\d{7}"
bracket_pattern = r"\s\((.*)\)"
date_pattern = r"\s\w{0,2}\/\w{0,2}\-\w{0,2}\/\w{0,2}"

ocrlist = []

passline = ''
index = 1
lineNo = 1

#튜플 > 리스트로 변환 후 line 값 임의 수정
if list_size > 0:
    inputOcr_list = sorted(inputOcr_list, key=lambda x:(x[0], x[5]))
    for i in range(list_size):
        ocrlist.append(list(inputOcr_list[i]))

    for i in range(list_size):
        ocrlist[i][0] = lineNo
        if (i + 1) % 5 == 0:
            lineNo = lineNo + 1

    #수정한 line 값 + x1 값으로 정렬
    ocrlist = sorted(ocrlist, key=lambda x:(x[0], x[5]))

    for i in range(list_size):
        try:    
            text = ocrlist[i][3]
            line = ocrlist[i][0]

            if passline != '' and line == passline:
                continue
            
            if 'TOTAL' in text :
                field_value['06_DESCRIPTION'] = ''
                field_value['06_RATE'] = ''
                field_value['06_UNIT'] = ''
                field_value['06_QTY'] = ''
                field_value['06_DEBIT'] = ''
                field_value['06_CREDIT'] = ''
                break
            elif i % 5 == 0:
                passline = ''
                
                #괄호, 날짜형식, 컨테이너를 치환으로 없앰
                text = re.sub(container_pattern, r"", text)
                text = re.sub(bracket_pattern, r"", text)
                text = re.sub(date_pattern, r"", text)
                # if "CONTAINER DRAYAGE FEE" in text or "HANDLING CHARGE TO AGENT" in text or "ISF FILING FEE" in text:
                #     passline = line
                #     continue
                field_value['06_DESCRIPTION'] = text   # field_value에 text 값 저장
            elif i % 5 == 1:
                field_value['06_RATE'] = text   # RATE 키에 value 값 저장
            elif i % 5 == 2:
                field_value['06_QTY'] = text   # RATE 키에 value 값 저장
                
            elif i % 5 == 4:
                field_value['06_DEBIT'] = text   # DEBIT 키에 value 값 저장
                field_value['06_UNIT'] = 'B/L'
                field_value['06_CREDIT'] = '0'
                         
        except:
            field_value['06_DESCRIPTION'] = ''
            field_value['06_RATE'] = ''
            field_value['06_UNIT'] = ''
            field_value['06_QTY'] = ''
            field_value['06_DEBIT'] = ''
            field_value['06_CREDIT'] = ''
